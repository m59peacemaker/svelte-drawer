<div
  class="
    svelte-drawer
    side-{{ side }}
    axis-{{ axis }}
    {{ isOpen ? 'open' : 'closed' }}
    {{ shouldTransition ? 'smooth' : '' }}
  "
  style="
    transform: translate3d({{ translate.x }}%, {{ translate.y }}%, 0);
    z-index: {{ zIndexBase + 1 }};
  "
  on:transitionend="set('temporarySmooth', undefined)"
>
  <slot></slot>
</div>

{{#if scrim && isOpen}}
  <div
    style="z-index: {{ zIndexBase }};"
    on:click="set({ open: false })"
  >
    <slot name="scrim">
      <Scrim/>
    </slot>
  </div>
{{/if}}

<script>
import Scrim from 'svelte-scrim'
import clamp from 'just-clamp'
const isLeadingSide = side => side === 'left' || side === 'top'

const DEFAULTS = {
  side: 'left',
  open: false, // true, false, 0 - 100 (percent)
  smooth: true,
  scrim: true,
  zIndexBase: 1
  //push: false // false, element/ref // TODO: push other content over when opening
}
Object.freeze(DEFAULTS)

export default {
  setup (Drawer) {
    Drawer.DEFAULTS = DEFAULTS
  },

  components: { Scrim },

  data () {
    return Object.assign({}, DEFAULTS)
  },

  computed: {
    percentOpen: open => !open ? 0 : (open === true ? 100 : clamp(0, 100, open)),
    isOpen: percentOpen => percentOpen === 100,
    axis: side => side === 'left' || side === 'right' ? 'x' : 'y',
    translate: (percentOpen, side, axis) => {
      const amount = isLeadingSide(side) ? percentOpen - 100 : 100 - percentOpen
      return axis === 'x' ? { x: amount, y: 0 } : { x: 0, y: amount }
    },
    shouldTransition: (smooth, temporarySmooth) =>
      temporarySmooth !== undefined ? temporarySmooth : smooth
  },

  methods: {
    toggle: function ({ smooth = true } = {}) {
      const open = !this.get('isOpen')
      this.set({ open, temporarySmooth: smooth })
      return { open }
    }
  }
}
</script>

<style>

.svelte-drawer {
  position: fixed;
  display: inline;
  transform: translate3d(0, 0, 0);
}

.svelte-drawer.smooth {
  transition: transform 300ms;
}

.axis-x {
  top: 0;
  bottom: 0;
  height: 100%;
}

.axis-y {
  left: 0;
  right: 0;
  width: 100%;
}

.side-top    { top: 0 }
.side-right  { right: 0 }
.side-bottom { bottom: 0 }
.side-left   { left: 0 }

</style>
